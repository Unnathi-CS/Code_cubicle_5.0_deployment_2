<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hackathon Dashboard - Real-time Insights</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .insight-card { transition: transform 0.2s ease-in-out; }
    .insight-card:hover { transform: translateY(-2px); }
    .live-indicator { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
  </style>
</head>
<body class="bg-light">

<!-- 🔹 Navbar -->
<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Hackathon Dashboard</a>
  </div>
</nav>

<!-- 🔹 Dashboard Container -->
<div class="container mt-4">

  <!-- Live Status -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-success d-flex align-items-center" role="alert">
        <span class="live-indicator me-2">🔴</span>
        <strong>Live Monitoring Active</strong>
        <span class="ms-auto" id="lastUpdate">Last updated: Just now</span>
      </div>
    </div>
  </div>

  <!-- AI Insights -->
  <div class="row mb-4">
    <div class="col-12"><h3>🤖 AI Insights</h3></div>
  </div>
  <div class="row">
    <div class="col-md-4 mb-3">
      <div class="card insight-card h-100">
        <div class="card-header bg-danger text-white">🚨 Problems</div>
        <div class="card-body scrollable-insight" style="max-height: 300px; overflow-y:auto;">
          <div id="problemsInsight">Loading...</div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card insight-card h-100">
        <div class="card-header bg-info text-white">❓ Questions</div>
        <div class="card-body scrollable-insight" style="max-height: 300px; overflow-y:auto;">
          <div id="questionsInsight">Loading...</div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card insight-card h-100">
        <div class="card-header bg-success text-white">📈 Trending</div>
        <div class="card-body scrollable-insight" style="max-height: 300px; overflow-y:auto;">
          <div id="trendingInsight">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeline + Mood -->
  <div class="row mt-4">
    <div class="col-lg-6 col-md-12 mb-4">
      <div class="card">
        <div class="card-header bg-primary text-white">📈 Message Timeline</div>
        <div class="card-body"><canvas id="timelineChart"></canvas></div>
      </div>
    </div>
    <div class="col-lg-6 col-md-12 mb-4">
      <div class="card">
        <div class="card-header bg-success text-white">😀 Mood Meter</div>
        <div class="card-body text-center" id="moodBox">Loading...</div>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let timelineChart;

// 🔹 Fetch AI Insights
async function fetchInsights() {
  const res = await fetch("/api/insights");
  const data = await res.json();
  document.getElementById("problemsInsight").innerHTML = data.problems || "No problems.";
  document.getElementById("questionsInsight").innerHTML = data.questions || "No questions.";
  document.getElementById("trendingInsight").innerHTML = data.trending || "No trends.";
}

// 🔹 Fetch Timeline
async function fetchTimeline() {
  const res = await fetch("/api/timeline");
  const data = await res.json();
  const labels = Object.keys(data).sort();
  const totals = labels.map(l => data[l].total);
  const problems = labels.map(l => data[l].problems);
  const questions = labels.map(l => data[l].questions);

  if (timelineChart) timelineChart.destroy();
  timelineChart = new Chart(document.getElementById("timelineChart"), {
    type: "line",
    data: {
      labels,
      datasets: [
        { label:"Total", data: totals, borderColor:"#007bff", fill:false },
        { label:"Problems", data: problems, borderColor:"#dc3545", fill:false },
        { label:"Questions", data: questions, borderColor:"#ffc107", fill:false }
      ]
    }
  });
}

// 🔹 Fetch Mood
async function fetchMood() {
  const res = await fetch("/api/mood");
  const data = await res.json();
  const moodBox = document.getElementById("moodBox");
  moodBox.innerHTML = `<h2>${data.mood}</h2>
    <p>😊 ${data.positives} | 😡 ${data.negatives}</p>`;
}

// 🔹 Refresh all widgets
async function refresh() {
  fetchInsights();
  fetchTimeline();
  fetchMood();
  document.getElementById("lastUpdate").innerText = "Last updated: " + new Date().toLocaleTimeString();
}

refresh();
setInterval(refresh, 15000); // auto-refresh
</script>
</body>
</html>
